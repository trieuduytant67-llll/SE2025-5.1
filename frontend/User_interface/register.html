<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đăng ký thành viên - AR.STORE</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { background: #f4f7fe; font-family: 'Plus Jakarta Sans', sans-serif; }
        .reg-card { border-radius: 30px; border: none; box-shadow: 0 20px 40px rgba(0,0,0,0.05); max-width: 450px; width: 100%; margin: auto; }
        .form-control { border-radius: 15px; padding: 12px; border: 1px solid #e0e7ff; background: #f8faff; }
        .btn-success { background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%); border: none; border-radius: 15px; padding: 12px; font-weight: 700; transition: 0.3s; }
        .btn-success:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0, 176, 155, 0.2); }
    </style>
</head>
<body class="d-flex align-items-center vh-100">
    <div class="card reg-card p-4 shadow-sm">
        <div class="text-center mb-4">
            <h3 class="fw-bold">TẠO TÀI KHOẢN</h3>
            <p class="text-muted small">Tham gia cộng đồng mua sắm AR ngay hôm nay</p>
        </div>
        
        <form id="regForm">
            <div class="mb-3">
                <label class="small fw-bold text-muted">HỌ VÀ TÊN</label>
                <input type="text" id="name" class="form-control" placeholder="Nhập tên của bạn" required>
            </div>
            <div class="mb-3">
                <label class="small fw-bold text-muted">EMAIL</label>
                <input type="email" id="email" class="form-control" placeholder="example@gmail.com" required>
            </div>
            <div class="mb-3">
                <label class="small fw-bold text-muted">MẬT KHẨU (Tối thiểu 8 ký tự)</label>
                <input type="password" id="password" class="form-control" placeholder="••••••••" required minlength="8">
            </div>
            <div class="mb-4">
                <label class="small fw-bold text-muted">XÁC NHẬN MẬT KHẨU</label>
                <input type="password" id="confirm_password" class="form-control" placeholder="••••••••" required minlength="8">
            </div>
            
            <button type="submit" class="btn btn-success w-100 mb-3 shadow">ĐĂNG KÝ NGAY</button>
            
            <div class="text-center small">
                <span class="text-muted">Đã có tài khoản?</span>
                <a href="login.html" class="fw-bold text-success text-decoration-none"> Đăng nhập</a>
            </div>
        </form>
    </div>

    <script>
        document.getElementById('regForm').onsubmit = async (e) => {
            e.preventDefault();
            
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const confirm = document.getElementById('confirm_password').value;

            // Kiểm tra mật khẩu khớp nhau ở phía Client
            if(password !== confirm) {
                return Swal.fire('Lỗi', 'Mật khẩu xác nhận không khớp!', 'error');
            }

            // Hiển thị trạng thái chờ
            Swal.fire({ 
                title: 'Đang khởi tạo tài khoản...', 
                allowOutsideClick: false,
                didOpen: () => Swal.showLoading() 
            });

            try {
                const res = await fetch("http://34.60.101.69/api/v1/register", {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Accept': 'application/json' 
                    },
                    body: JSON.stringify({ 
                        name, 
                        email, 
                        password, 
                        password_confirmation: confirm 
                    })
                });

                const data = await res.json();

                if (res.ok) {
                    Swal.fire({
                        icon: 'success',
                        title: 'Đăng ký thành công!',
                        text: 'Chào mừng bạn đến với AR.STORE',
                        confirmButtonColor: '#00b09b'
                    }).then(() => {
                        window.location.href = 'login.html';
                    });
                } else {
                    // XỬ LÝ LỖI VALIDATION TỪ LARAVEL
                    let errorMsg = data.message;
                    if (data.errors) {
                        // Lấy lỗi đầu tiên trong danh sách lỗi trả về
                        errorMsg = Object.values(data.errors)[0][0];
                    }
                    Swal.fire('Lỗi đăng ký', errorMsg, 'error');
                }
            } catch (err) {
                Swal.fire('Lỗi kết nối', 'Không thể kết nối đến máy chủ API', 'error');
            }
        };
    </script>
</body>
</html>
